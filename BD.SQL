CREATE DATABASE SOUBO;
USE SOUBO;

CREATE TABLE USUARIO (
ID INT UNSIGNED AUTO_INCREMENT NOT NULL,
NOME VARCHAR(20) NOT NULL,
SOBRENOME VARCHAR(80) NOT NULL,
SEXO CHAR(1) NOT NULL,
CELULAR CHAR(11) NOT NULL,
EMAIL VARCHAR(80) NOT NULL,
DT_NASCIMENTO DATE NOT NULL,
ENDERECO VARCHAR(100) NOT NULL,
ID_CIDADE INT UNSIGNED NOT NULL,
ID_ESTADO INT UNSIGNED NOT NULL,
APELIDO VARCHAR(50),
ID_TIME INT UNSIGNED NOT NULL,
ID_POSICAO INT UNSIGNED NOT NULL,
PONTUACAO INT NOT NULL,
SENHA VARCHAR(120) NOT NULL,
FOTO_PERFIL VARCHAR(120),
TIPO_USUARIO CHAR(1) NOT NULL,
PRIMARY KEY(ID),
FOREIGN KEY(ID_CIDADE) REFERENCES CIDADE(cid_id),
FOREIGN KEY(ID_ESTADO) REFERENCES ESTADO(est_id),
FOREIGN KEY(ID_TIME) REFERENCES TIME_ESP(ID),
FOREIGN KEY(ID_POSICAO) REFERENCES POSICAO(ID)
);

CREATE TABLE QUADRA (
ID INT UNSIGNED AUTO_INCREMENT NOT NULL,
NOME VARCHAR(80) NOT NULL,
ENDERECO VARCHAR(100) NOT NULL,
NUMERO INT UNSIGNED NOT NULL,
LAT DECIMAL(10,8) NOT NULL,
LNG DECIMAL(11,8) NOT NULL,
USUARIO_ID INT UNSIGNED NOT NULL,
PRIMARY KEY(ID),
FOREIGN KEY(USUARIO_ID) REFERENCES USUARIO(ID)
);

CREATE TABLE SERVICOS (
ID INT UNSIGNED AUTO_INCREMENT NOT NULL,
NOME VARCHAR(80) NOT NULL,
DSC VARCHAR(100) NOT NULL,
PRIMARY KEY(ID)
);

CREATE TABLE SERVICOS_QUADRA (
QUADRA_ID INT UNSIGNED NOT NULL,
SERVICOS_ID INT UNSIGNED NOT NULL,
FOREIGN KEY(SERVICOS_ID) REFERENCES SERVICOS(ID) 
);

CREATE TABLE FUNCIONAMENTO_QUADRA (
QUADRA_ID INT UNSIGNED NOT NULL,
DIA CHAR(1) NOT NULL,
H_ABERTURA TIME NOT NULL,
H_FECHAMENTO TIME NOT NULL,
FOREIGN KEY(QUADRA_ID) REFERENCES QUADRA(ID)
);

CREATE TABLE RESERVA (
ID INT UNSIGNED AUTO_INCREMENT NOT NULL,
RESPONSAVEL INT UNSIGNED NOT NULL,
DIA DATE NOT NULL,
HORA_ENTRADA TIME NOT NULL,
HORA_SAIDA TIME NOT NULL,
QUADRA_ID INT UNSIGNED NOT NULL,
PRIMARY KEY(ID),
FOREIGN KEY(RESPONSAVEL) REFERENCES USUARIO(ID),
FOREIGN KEY(QUADRA_ID) REFERENCES QUADRA(ID)
);

CREATE TABLE JOGADORES_RESERVA (
RESERVA_ID INT UNSIGNED NOT NULL,
USUARIO_ID INT UNSIGNED NOT NULL,
FOREIGN KEY(RESERVA_ID) REFERENCES RESERVA(ID),
FOREIGN KEY(USUARIO_ID) REFERENCES USUARIO(ID)
);


SELECT Q.*, S.NOME, U.NOME DONO
FROM QUADRA Q
INNER JOIN SERVICOS_QUADRA SQ ON SQ.QUADRA_ID = Q.ID
INNER JOIN SERVICOS S ON SQ.SERVICOS_ID = S.ID
INNER JOIN USUARIO U ON Q.USUARIO_ID = U.USUARIO_ID